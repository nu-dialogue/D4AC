(function(t){function e(e){for(var s,a,r=e[0],c=e[1],u=e[2],h=0,d=[];h<r.length;h++)a=r[h],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&d.push(o[a][0]),o[a]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(t[s]=c[s]);l&&l(e);while(d.length)d.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],s=!0,r=1;r<n.length;r++){var c=n[r];0!==o[c]&&(s=!1)}s&&(i.splice(e--,1),t=a(a.s=n[0]))}return t}var s={},o={app:0},i=[];function a(e){if(s[e])return s[e].exports;var n=s[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=s,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(n,s,function(e){return t[e]}.bind(null,s));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var u=0;u<r.length;u++)e(r[u]);var l=c;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},"034f":function(t,e,n){"use strict";n("85ec")},"0898":function(t,e,n){},"09d8":function(t,e,n){},"14b8":function(t,e,n){"use strict";n("0898")},"85ec":function(t,e,n){},"977c":function(t,e,n){"use strict";n("a714")},a0c4:function(t,e,n){"use strict";n("09d8")},a714:function(t,e,n){},bdf8:function(t,e,n){"use strict";n("d78e")},c454:function(t,e,n){},cd49:function(t,e,n){"use strict";n.r(e);var s=n("2b0e"),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",{staticClass:"d-flex flex-column",attrs:{fluid:"",id:"app"}},[n("b-navbar",{staticClass:"d-frex",attrs:{variant:"info"}},[n("b-navbar-brand",[t._v("D4AC")]),n("b-navbar-nav",[n("b-nav-item",{staticClass:"mr-4",attrs:{to:"/"}},[t._v("Chrome Speech Synthesis")]),n("b-nav-item",{staticClass:"mr-4",attrs:{to:"/Amazon"}},[t._v("Amazon Polly")]),n("b-nav-item",{staticClass:"mr-4",attrs:{to:"/Text"}},[t._v("Text IO")])],1)],1),n("router-view")],1)},i=[],a=n("bc3a"),r=n.n(a),c={name:"app",created(){r.a.get("/config/").then(t=>{console.log(JSON.stringify(t.data)),this.$store.commit("setPeriod",t.data.user_status.silence.period),this.$store.commit("setSilence",t.data.user_status.silence.send),this.$store.commit("setSuEnd",t.data.user_status.su_end.send),this.$store.commit("setUuEnd",t.data.user_status.uu_end.send),this.$store.commit("setBotId",t.data.dialog_server.botId),this.$store.commit("setInitTopicId",t.data.dialog_server.initTopicId),this.$store.commit("setContinuousVoiceRecognition",t.data.continuous_voice_recognition),this.$store.commit("setPollyIdentityPoolId",t.data.amazon_polly.identityPoolId),this.$store.commit("setPollyRegion",t.data.amazon_polly.region)})}},u=c,l=(n("034f"),n("2877")),h=Object(l["a"])(u,o,i,!1,null,null,null),d=h.exports,p=n("8c4f"),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",{staticClass:"d-flex flex-column"},[n("header",[n("b-row",[n("h1",[t._v(" D4AC (with Chrome Speech Synthesis) "),n("b-button",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],on:{click:t.startGoogle}},[t._v("Start Dialog")]),n("b-icon",{directives:[{name:"show",rawName:"v-show",value:t.voice,expression:"voice"}],attrs:{icon:"chat-dots",scale:"2",animation:"throb"}}),t._v(" "+t._s(t.userutterance)+" "+t._s(t.status)+" ")],1)])],1),n("article",t._l(t.utterances,(function(t){return n(t.component,{key:t,tag:"component",attrs:{utterance:t.utterance}})})),1)])},g=[],f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-row",{attrs:{"align-h":"end"}},[n("b-col",{staticClass:"system",attrs:{cols:"11"}},[t._v(" "+t._s(t.utterance)),n("b-avatar",{attrs:{variant:"primary"}})],1)],1)},v=[],b={name:"SystemUtterance",props:{expression:String,utterance:String},created(){console.log("created system")}},y=b,w=(n("977c"),Object(l["a"])(y,f,v,!1,null,"327cb2f4",null)),_=w.exports,x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-row",{attrs:{"align-h":"start"}},[n("b-col",{staticClass:"user",attrs:{cols:"11"}},[n("b-avatar",{attrs:{variant:"success"}}),t._v(t._s(t.utterance))],1)],1)},S=[],I={name:"UserUtterance",props:{utterance:String,expression:String}},$=I,U=(n("d2a0"),Object(l["a"])($,x,S,!1,null,"9ebc9ce4",null)),R=U.exports,O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-row",{attrs:{"align-h":"end"}},[n("b-col",{attrs:{cols:"2"}},[n("b-img",{attrs:{thumbnail:"",src:t.imgSrc,rounded:""}})],1)],1)},C=[],P={name:"UtteranceImage",props:{expression:String,utterance:String},computed:{imgSrc:function(){return"/static/images/"+this.utterance}},created(){console.log("created  Image")}},T=P,A=Object(l["a"])(T,O,C,!1,null,null,null),E=A.exports,j={data(){return{sessionId:"",started:!1,first:!0,voice:!1,recog:void 0,speechFunc:void 0,utterances:[],status:"",interval:void 0}},computed:{isShow:function(){return!this.voice}},methods:{send:async function(t){try{if(this.first){const e=await r.a.get(`/continuefirst/${this.sessionId}/${t}`);console.log("/continuefirst/",e),this.first=!1,await this.system(e.data.systemUtterance)}else{const e=await r.a.get(`/continue/${this.sessionId}/${t}`);console.log("/continuefirst/",e),await this.system(e.data.systemUtterance)}}catch(e){this.status="D4AC Error"}},start:async function(){this.started||(await this.sendStart("start"),this.started=!0)},startWithRecognition:async function(t){if(this.speechFunc=t,this.started)console.log("voice recognition start manually"),this.recog.start();else{console.log("sendStart"),await this.sendStart("start"),this.started=!0;const t=window.webkitSpeechRecognition||window.SpeechRecognition,e=new t;e.interimResults=!0,e.continuous=!0,e.onresult=async t=>{console.log("speech recognition onresult"),void 0!=this.interval&&(console.log("cancel send userstatus"),clearInterval(this.interval),this.interval=void 0);const e=t.results.length;this.userutterance=t.results[e-1][0].transcript,t.results[e-1].isFinal&&(this.utterances.unshift({component:"UserUtterance",expression:this.userutterance,utterance:this.userutterance}),this.$store.state.continuousVoiceRecognition||(console.log("recog abort"),this.recog.abort()),await this.send(this.userutterance))},e.onaudiostart=async()=>{console.log("recog start audio"),this.voice=!0},e.onaudioend=async()=>{console.log("recog stop audio"),this.voice=!1},e.onend=async()=>{console.log("recog onend"),this.$store.state.continuousVoiceRecognition&&this.started?(console.log("restarting recog"),this.recog.start()):(console.log("no restarting recog"),this.voice=!1)},e.nomatch=async()=>{console.log("recog not match"),this.voice=!1},this.recog=e,this.$store.state.continuousVoiceRecognition&&this.recog.start()}},sendStart:async function(t){try{const e=await r.a.get("/start/"+t);console.log(e),this.sessionId=e.data.sessionId,await this.system(e.data.systemUtterance)}catch(e){this.status="D4AC Error"}},afterSpeech:async function(){if(this.$store.state.su_end&&await this.sendEngagement(),this.$store.state.silence){const t=1e3*this.$store.state.period;console.log("start send userstatus",t),void 0!=this.interval&&clearInterval(this.interval),this.interval=setInterval(async()=>{const t=await r.a.get("/userstatus/"+this.sessionId);console.log("userstatus",t),null!=t.data&&void 0!=t.data.systemUtterance&&this.system(t.data.systemUtterance)},t)}if(!this.$store.state.continuousVoiceRecognition)try{this.recog.start()}catch(t){console.log(t)}},sendEngagement:async function(){if(this.isSystem=!1,""!=this.sessionId)try{const t=await r.a.get("/engagement/"+this.sessionId);console.log(t),null!=t.data&&void 0!=t.data.systemUtterance&&this.system(t.data.systemUtterance)}catch(t){this.status="D4ACエラー"}},stop:function(){null!=this.recog&&this.recog.stop(),this.recog=null},system:async function(t){const e=t.utterance;if(""!=e){const t=/\(.*?\)/,n=e.match(t);if(null!=n){const t=/^.*?\(/,s=e.match(t),o=n[0],i=o.substring(1,o.length-1),a=s[0],r=a.substring(0,a.length-1);console.log(`utter ${i} ${r}`),this.utterances.unshift({component:"SystemUtterance",expression:r,utterance:r}),this.utterances.unshift({component:"UtteranceImage",expression:i,utterance:i}),void 0!=this.speechFunc&&(this.$store.state.continuousVoiceRecognition||(console.log("recog abort"),void 0!=this.recog&&this.recog.abort()),void 0!=this.interval&&(console.log("cancel send userstatus"),clearInterval(this.interval),this.interval=void 0),this.speechFunc(r))}else this.utterances.unshift({component:"SystemUtterance",expression:e,utterance:e}),void 0!=this.speechFunc&&(this.$store.state.continuousVoiceRecognition||(console.log("recog abort"),void 0!=this.recog&&this.recog.abort()),void 0!=this.interval&&(console.log("cancel send userstatus"),clearInterval(this.interval),this.interval=void 0),this.speechFunc(e))}}}},D={name:"DialogMainGoogle",mixins:[j],components:{SystemUtterance:_,UserUtterance:R,UtteranceImage:E},beforeRouteLeave(t,e,n){this.started=!1,void 0!=this.recog&&this.recog.abort(),n()},methods:{startGoogle:function(){this.startWithRecognition(this.speechfuncGoogle)},speechfuncGoogle:async function(t){console.log("speechfuncGoogle "+t);const e=new SpeechSynthesisUtterance;e.text=t,e.addEventListener("start",()=>{console.log("start system voice"),this.isSystem=!0}),e.addEventListener("end",this.afterSpeech),window.speechSynthesis.cancel(),window.speechSynthesis.speak(e)}}},k=D,z=(n("14b8"),Object(l["a"])(k,m,g,!1,null,"13149ab2",null)),V=z.exports,M=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",{staticClass:"d-flex flex-column"},[n("header",[n("b-row",[n("h1",[t._v(" D4AC (Amazon Polly Speech Synthesizer) "),n("b-button",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],on:{click:t.startAmazon}},[t._v("Start Dialog")]),n("b-icon",{directives:[{name:"show",rawName:"v-show",value:t.voice,expression:"voice"}],attrs:{icon:"chat-dots",scale:"2",animation:"throb"}}),t._v(" "+t._s(t.userutterance)+" "+t._s(t.status)+" ")],1)])],1),n("article",t._l(t.utterances,(function(t){return n(t.component,{key:t,tag:"component",attrs:{utterance:t.utterance}})})),1),n("footer",[n("audio",{attrs:{src:""}})])])},F=[],G=n("bc38"),N=n("b66a"),L=n("fe0e"),J=n("74b9");let W=void 0;const B={OutputFormat:"mp3",SampleRate:"16000",Text:"",TextType:"text",VoiceId:"Takumi"};var q={name:"DialogMainAmazon",mixins:[j],components:{SystemUtterance:_,UserUtterance:R,UtteranceImage:E},beforeRouteLeave(t,e,n){this.started=!1,void 0!=this.recog&&this.recog.abort(),n()},methods:{startAmazon:function(){W=new L["a"]({region:this.$store.state.pollyRegion,credentials:Object(N["a"])({client:new G["a"]({region:this.$store.state.pollyRegion}),identityPoolId:this.$store.state.pollyIdentityPoolId})}),this.startWithRecognition(this.speechfuncAmazon)},speechfuncAmazon:async function(t){console.log("speechfuncAmazon "+t),B.Text=t;try{let t=await Object(J["a"])({client:W,params:B});console.log(t);const e=new Audio(t);e.autoplay=!0,e.addEventListener("ended",this.afterSpeech),e.load(),e.play()}catch(e){console.log("Error",e)}}}},H=q,K=(n("bdf8"),Object(l["a"])(H,M,F,!1,null,"1dda150b",null)),Q=K.exports,X=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",{staticClass:"d-flex flex-column"},[n("header",[n("b-row",[n("h1",[t._v(" D4AC (Text Input/Output) "),n("b-button",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],on:{click:t.start}},[t._v("Start Dialog")]),n("b-icon",{directives:[{name:"show",rawName:"v-show",value:t.voice,expression:"voice"}],attrs:{icon:"chat-dots",scale:"2",animation:"throb"}}),t._v(" "+t._s(t.userutterance)+" "+t._s(t.status)+" ")],1)])],1),n("article",t._l(t.utterances,(function(t){return n(t.component,{key:t,tag:"component",attrs:{utterance:t.utterance}})})),1),n("footer",[t.started?n("b-form",{attrs:{inline:""}},[n("b-form-input",{staticClass:"mb-8",attrs:{id:"input-1",placeholder:"text input"},model:{value:t.input_text,callback:function(e){t.input_text=e},expression:"input_text"}}),n("b-button",{on:{click:t.textinput}},[t._v("Text Input")])],1):t._e()],1)])},Y=[],Z={name:"DialogMainText",mixins:[j],data(){return{input_text:""}},components:{SystemUtterance:_,UserUtterance:R,UtteranceImage:E},beforeRouteLeave(t,e,n){this.started=!1,n()},methods:{textinput:function(){this.utterances.unshift({component:"UserUtterance",expression:this.input_text,utterance:this.input_text}),this.send(this.input_text)}}},tt=Z,et=(n("a0c4"),Object(l["a"])(tt,X,Y,!1,null,"f501e08a",null)),nt=et.exports;s["default"].use(p["a"]);var st=[{path:"/",name:"DialogMainGoogle",component:V},{path:"/Amazon",name:"DialogMainAmazon",component:Q},{path:"/Text",name:"DialogMainText",component:nt}],ot=new p["a"]({mode:"hash",base:"",routes:st}),it=ot,at=n("2f62");s["default"].use(at["a"]);var rt=new at["a"].Store({state:{botId:"aaaaa",initTopicId:"bbbbb",continuousVoiceRecognition:!1,pollyIdentityPoolId:"",pollyRegion:"",silence:!1,su_end:!1,uu_end:!1,period:5},mutations:{setBotId:function(t,e){t.botId=e},setInitTopicId:function(t,e){t.initTopicId=e},setContinuousVoiceRecognition:function(t,e){t.continuousVoiceRecognition=e},setPollyIdentityPoolId:function(t,e){t.pollyIdentityPoolId=e},setPollyRegion:function(t,e){t.pollyRegion=e},setSilence:function(t,e){t.silence=e},setPeriod:function(t,e){t.period=e},setSuEnd:function(t,e){t.su_end=e},setUuEnd:function(t,e){t.uu_end=e}},actions:{},modules:{}}),ct=n("5f5b"),ut=n("b1e0");n("f9e3"),n("2dd8");s["default"].config.productionTip=!1,s["default"].use(ct["a"]),s["default"].use(ut["a"]),new s["default"]({router:it,store:rt,render:function(t){return t(d)}}).$mount("#app")},d2a0:function(t,e,n){"use strict";n("c454")},d78e:function(t,e,n){}});
//# sourceMappingURL=app.030b70f9.js.map